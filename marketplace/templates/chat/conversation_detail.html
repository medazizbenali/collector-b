{% extends "base.html" %}
{% block title %}Conversation{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-4">
  <h1 class="text-2xl font-bold">Conversation</h1>
  <a class="text-sm text-cyan-300 hover:underline" href="{% url 'my_conversations' %}">
    ← Retour
  </a>
</div>

<div class="rounded-3xl border border-white/10 bg-white/5 p-5">
  <div class="text-sm text-slate-300 mb-4">
    Item: <span class="font-semibold">{{ conversation.item.title }}</span>
  </div>

  <div class="space-y-3 max-h-[420px] overflow-auto pr-2">
    {% for m in messages %}
      <div class="{% if m.sender_id == user.id %}text-right{% endif %}">
        <div class="inline-block max-w-[80%] rounded-2xl px-4 py-2
          {% if m.sender_id == user.id %}
            bg-cyan-400/20 border border-cyan-400/20
          {% else %}
            bg-white/5 border border-white/10
          {% endif %}
        ">
          <div class="text-xs text-slate-400 mb-1">
            {{ m.sender.username }} • {{ m.created_at }}
          </div>
          <div class="text-sm">{{ m.content }}</div>

          {% if user.is_staff and m.is_hidden %}
            <div class="text-xs text-red-300 mt-1">⛔ message masqué</div>
          {% endif %}
        </div>
      </div>
    {% empty %}
      <div class="text-slate-400">Aucun message.</div>
    {% endfor %}
  </div>

  <form method="post" class="mt-4 flex gap-2">
    {% csrf_token %}
    <input name="content"
           class="flex-1 rounded-2xl bg-slate-950/40 border border-white/10 px-4 py-3 text-white"
           placeholder="Écrire un message..." />
    <button class="px-5 rounded-2xl bg-gradient-to-r from-indigo-500 to-cyan-400 text-slate-950 font-semibold">
      Envoyer
    </button>
  </form>
</div>
{% endblock %}
